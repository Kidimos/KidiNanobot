---
name: calculate
description: 提供基础数学计算功能和常用换算功能(单位换算、货币换算)，可作为独立技能响应计算提问，也可作为工具被其他技能调用。
author: Kidimos
version: 0.0.2
triggers:
  - 计算
  - 换算
  - 转换
  - convert
  - 等于多少
  # 可选：添加 capabilities 字段，标明本技能提供的能力（如果有此规范）
capabilities:
  - math_evaluation
  - unit_conversion
  - currency_conversion
---

## 功能概述
本技能包含两大功能：
1. **数学计算**：支持加减乘除、乘方、括号，适用于纯数值表达式。
2. **换算功能**：支持常用单位换算（长度、重量、温度、体积等）和货币换算（需要实时汇率时，假设你可以访问网络或使用内置汇率表）。
3. 
换算功能基于数学计算实现，例如将“5 km to miles”转换为“5 * 0.621371”并计算结果。

---

## 1. 作为独立技能的使用方法

### 1.1 数学计算
当用户直接要求计算时，提取表达式并返回结果。示例：
- “计算 5 + 3” → `5 + 3 = 8`
- “2 的 3 次方” → `2 ** 3 = 8`

### 1.2 换算功能
当用户要求换算时，解析源数值、源单位和目标单位，执行换算。支持的换算类型：

| 类别       | 示例输入                            | 内部处理（换算系数）                       |
|------------|-------------------------------------|--------------------------------------------|
| 长度       | “5 km to miles”                     | 1 km = 0.621371 miles                      |
| 重量       | “10 kg to lbs”                      | 1 kg = 2.20462 lbs                         |
| 温度       | “100 °C to °F”                      | °F = °C * 9/5 + 32                         |
| 体积       | “2 liters to gallons”               | 1 liter = 0.264172 gallons                 |
| 货币       | “100 USD to EUR”                    | 需要实时汇率（假设你可以调用汇率 API 或使用内置缓存） |

**示例响应**：
- 用户：“5 km to miles” → `5 km = 3.10686 miles`
- 用户：“100 美元 换算 欧元” → `100 美元 = 85.20 欧元`（假设汇率为 0.852）
---

## 2. 作为工具被其他技能调用

其他技能（如记账、国际金价查询）可以调用本技能完成计算或换算子任务。调用时需提供明确的输入格式，并获取标准化的输出。

### 2.1 调用数学计算
**输入**：一个数学表达式字符串，例如 `"3.5 * (2 + 1)"`。  
**输出**：成功时返回 `计算结果: {表达式} = {数值}`；失败时返回 `错误: {错误信息}`。

### 2.2 调用换算功能
**输入**：一个描述换算的字符串，建议格式为 `"{数值} {源单位} to {目标单位}"`（或类似自然语言）。例如 `"5 km to miles"`、`"100 USD to EUR"`。  
**输出**：成功时返回 `换算结果: {数值} {源单位} = {结果} {目标单位}`；失败时返回 `错误: {错误信息}`（如不支持的单位、无法获取汇率等）。

### 2.3 调用示例（供其他技能参考）

**示例1：国际金价查询技能需要将美元/盎司换算为人民币/克**  
> 你从 API 获取到当前金价为 `1800 USD/oz`，用户询问“金价是多少人民币一克？”  
> 你需要调用 `calculate` 两次：
> 1. 调用货币换算：将 `1800 USD` 换算为人民币，假设汇率为 6.5，得到 `1800 USD = 11700 CNY`。
> 2. 调用单位换算：将盎司转换为克（1 oz = 28.3495 g），因此金价（元/克）= `11700 / 28.3495`。将表达式 `"11700 / 28.3495"` 交给计算功能，得到结果 `412.8`。  
> 最终返回：“当前金价约为 412.8 元/克。”

**示例2：记账技能需要汇总多币种消费**  
> 用户记录了“午餐 15 USD”和“咖啡 5 EUR”，并询问“总共花了多少人民币？”  
> 你需要分别将 USD 和 EUR 换算为人民币（调用货币换算），然后求和（调用计算功能）。

---

## 3. 换算功能的实现细节

### 3.1 单位换算表（内置）
对于常见单位，请使用以下换算系数（你可以根据实际需要扩展）：

| 类别 | 换算规则 |
|------|----------|
| 长度 | 1 km = 0.621371 miles, 1 mile = 1.60934 km, 1 m = 3.28084 ft, ... |
| 重量 | 1 kg = 2.20462 lbs, 1 lb = 0.453592 kg, 1 g = 0.035274 oz, ... |
| 温度 | °C 转 °F: (°C * 9/5) + 32；°F 转 °C: (°F - 32) * 5/9 |
| 体积 | 1 L = 0.264172 gal (US), 1 gal = 3.78541 L, ... |

### 3.2 货币换算
- 如果无法获取实时汇率，可以使用固定的参考汇率（例如 1 USD = 0.85 EUR），但需在结果中注明“基于参考汇率”。
- 如果环境允许网络访问，建议调用免费汇率 API（如 exchangerate-api.com 或 open.er-api.com），并处理响应。
- 在指令中说明如何获取汇率，例如：“你需要使用汇率 API，假设 API 地址为 `https://api.exchangerate-api.com/v4/latest/USD`，解析 JSON 获得汇率。”

### 3.3 解析自然语言
由于用户输入可能多样（如“5公里换成英里”、“100美元兑欧元”），你需要利用自然语言理解能力提取数值、源单位和目标单位。在指令中列举常见表达方式，帮助代理准确解析。

---

## 4. 错误处理
- 如果单位不支持，返回“不支持的单位换算，请检查单位名称”。
- 如果货币换算缺少汇率，返回“无法获取实时汇率，请稍后再试”或使用默认汇率并提示。
- 对于表达式计算，同数学计算错误处理。

---

## 5. 注意事项
- 本技能不负责存储换算历史，只进行即时计算。
- 对于温度换算，注意公式的特殊性（不是简单乘除）。
- 其他技能调用时，确保提供的单位名称与换算表中的一致（例如使用标准缩写或全称）。

---

